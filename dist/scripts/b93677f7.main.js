(function(){var a,b,d,e,f,g,h,i,j,k,l,m,n,o;window.c=console,window.c.l=c.log,f={},window.app=f,b=function(){function a(a){var b,c;this.rstT=!1,this.funct="=",this.oct="=",this.note="=",this.vel="=",this.DLYfdb="=",this.DLYdepth="=";for(b in a)c=a[b],null!=this[b]&&(this[b]=c)}return a}(),a=function(){function a(a){var b,c;this.name="new pattern",this.color="#f48",this.tPerStep=8192,this.steps=16,this.data=[];for(b in a)c=a[b],null!=this[b]&&(this[b]=c)}return a}(),f.data={mode:"pattern",activeCh:0,selPatterns:[0,1,2,3,4,5],patterns:[new a,new a,new a,new a,new a,new a],getActivePattern:function(){return this.patterns[this.selPatterns[this.activeCh]]},getActivePatterns:function(){var a,b,c,d,e,f,g;for(c=[],f=this.selPatterns,g=[],b=d=0,e=f.length;e>d;b=++d)a=f[b],g.push(c[a]=this.patterns[b]);return g},songView:null,songs:[null,null]},f.renderPtnOptions=function(a){var b,c,d,e,g,h,i,j;for(a===!0?(g="PATTERN",b="patterns"):(g="SONG",b="songs"),e=document.getElementById("selectItems"),d="<option>SELECT "+g+"</option>",j=f.data[b],h=0,i=j.length;i>h;h++)c=j[h],d+="<option>"+c.name+"</option>";return e.innerHTML=d},m=null,n=null,k=0,i=0,l=99990,f.initAnimation=function(){var a;return m=document.getElementById("ptnPosition"),n=document.getElementsByClassName("data")[0].childNodes[0],k=n.childNodes[0].offsetHeight,i=n.childNodes[1].offsetHeight,a=document.styleSheets[0].rules,e()},d=15,e=function(){var a,b;return b=document.getElementsByClassName("active"),b.length>0&&(b[0].className=""),a=document.getElementById("row"+d),a.className="active",d=++d%16},g=new Worker("workers/calcPtn.js"),g.onmessage=function(a){return"undefined"==typeof h||null===h?j():h.writeBufferSync(a.data)},f.play=function(){var a;return a=JSON.stringify(f.data.getActivePatterns()),g.postMessage(a)},f.stop=function(){return h.kill()},h=void 0,o=!1,j=function(){var a,b;return f.play(),a=f.data.getActivePattern().tPerStep/32,h=audioLib.Sink(null),f.dev=h,b=h.getPlaybackTime(),h.on("audioprocess",function(){var c;return c=h.getPlaybackTime(),c>b+a&&(e(),b=c),this.getSyncWriteOffset()<8192&&o?(f.play(),o=!1):o!==!0?o=!0:void 0})},f.initDev=j,f.animateRow=e}).call(this),function(){window.findKeyframesRule=function(a){var b,c,d,e,f,g,h;for(e=document.styleSheets,b=0;b<e.length;){for(c=0;c<e[b].cssRules.length;){if(f=e[b].cssRules[c].type,h=f===window.CSSRule.WEBKIT_KEYFRAMES_RULE,g=f===window.CSSRule.KEYFRAMES_RULE,d=e[b].cssRules[c].name===a,(h||g)&&d)return e[b].cssRules[c];++c}++b}return null}}.call(this),function(){var a,b,c;for(a=0,b=["webkit","moz"],c=0;c<b.length&&!window.requestAnimationFrame;)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"],++c;window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c,d,e;return c=(new Date).getTime(),e=Math.max(0,16-(c-a)),d=window.setTimeout(function(){return b(c+e)},e),a=c+e,d}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){return clearTimeout(a)})}.call(this),function(){var a,b,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F;app.renderPattern=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o;for(f=["Tpos","pos","rstT","funct","oct","note","vel","DLYfdb","DLYdepth"],b=f.length,c=a.steps,g=c,d=b,e=document.createDocumentFragment(),h=e.appendChild(document.createElement("table")),j=h.appendChild(document.createElement("thead")),i=h.appendChild(document.createElement("tbody")),n=j.appendChild(document.createElement("tr"));d--;)m=n.appendChild(document.createElement("th")),m.className=m.innerHTML=f[b-d-1];for(;g--;)for(n=i.appendChild(document.createElement("tr")),n.id="row"+(c-g-1),d=b;d--;)l=n.appendChild(document.createElement("td")),l.addEventListener("click",F),o=f[b-d-1],l.className=o,l.innerHTML="pos"===o?c-g-1:"Tpos"===o?(c-g)*a.tPerStep:"rstT"===o?null!=a.data[c-g-1]&&a.data[c-g-1][o]===!0?"yes":"no":null!=a.data[c-g-1]?a.data[c-g-1][o]:"=";return k=document.querySelector("#pattern .data"),k.innerHTML="",k.appendChild(e)},a=function(){function a(a){var b,c;this.rstT=!1,this.funct="=",this.oct="=",this.note="=",this.vel="=",this.DLYfdb="=",this.DLYdepth="=";for(b in a)c=a[b],null!=this[b]&&(this[b]=c)}return a}(),l=function(a){return a.replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<")},p=function(a,b){return"="===a?a:(a=parseInt(a),isNaN(a)?0:a>b?b:-b>a?-b:a)},k={},s=0,m="0",E=new Worker("workers/testFormula.js"),D=function(a){return E.postMessage(a)},E.onmessage=function(a){var b;return a.data===!1?(app.data.getActivePattern().data[s].funct=m,k.parentNode.innerHTML=m):(b=app.data.getActivePattern().data[s].funct,k.parentNode.innerHTML=b,c.l("funct: '"+m+"' at pos: "+s+"\nERROR: "+a.data))},F=function(b){var d,e,f,g,h,i,j;if(d=document.getElementById("activePtnInput"),i=b.target.className,"pos"===h||"Tpos"===h)return!1;if(null!==d){if(null!=d&&d.parentNode===b.target.parentNode)return c.l("same");j=d.value,g=d.parentNode.parentNode.id.split("row")[1],h=d.parentNode.className,f=app.data.getActivePattern(),null==f.data[g]&&(f.data[g]=new a),"oct"===h||"note"===h?j=p(j,12):"vel"===h&&(j=p(j,100)),"funct"===h&&"="!==j?(s=g,m=j,k=d,D(j)):(f.data[g][h]=j,d.parentNode.innerHTML=j)}return"rstT"===i?(g=b.target.parentNode.id.split("row")[1],f=app.data.getActivePattern(),null==f.data[g]&&(f.data[g]=new a),j=!f.data[g].rstT,b.target.innerHTML=j===!0?"yes":"no",f.data[g].rstT=j):(j=l(b.target.innerHTML),e=document.createElement("input"),e.id="activePtnInput",e.style.width=b.target.clientWidth-2+"px",e.value=j,b.target.innerHTML="",b.target.appendChild(e).select())},d=document.getElementById("ptnChannel"),h=document.getElementById("chPlus"),f=document.getElementById("chMinus"),g=function(){return app.data.activeCh=(app.data.activeCh+1)%6,b()},e=function(){return app.data.activeCh=(app.data.activeCh-1)%6,app.data.activeCh<0&&(app.data.activeCh=5),b()},b=function(){var a;return d.innerHTML="ch: "+app.data.activeCh,a=app.data.getActivePattern(),app.renderPattern(a),app.refreshPtnOptions(!1)},h.addEventListener("click",g,!1),f.addEventListener("click",e,!1),t=document.getElementById("steps"),x=document.getElementById("stepsPlus"),v=document.getElementById("stepsMinus"),w=function(){var a;return a=app.data.getActivePattern(),a.steps*=2,a.steps>512&&(a.steps=512),i(a)},u=function(){var a;return a=app.data.getActivePattern(),a.steps/=2,a.steps<4&&(a.steps=4),i(a)},i=function(a){return t.innerHTML="steps: "+a.steps,app.renderPattern(a)},x.addEventListener("click",w,!1),v.addEventListener("click",u,!1),y=document.getElementById("tPerStep"),C=document.getElementById("tStepPlus"),A=document.getElementById("tStepMinus"),B=function(){var a;return a=app.data.getActivePattern(),a.tPerStep*=2,a.tPerStep>65e3&&(a.tPerStep=a.tPerStep/2),j(a)},z=function(){var a;return a=app.data.getActivePattern(),a.tPerStep/=2,a.tPerStep<16&&(a.tPerStep=16),j(a)},j=function(a){return y.innerHTML="tPerStep: "+a.tPerStep,app.renderPattern(a)},C.addEventListener("click",B,!1),A.addEventListener("click",z,!1),q=document.getElementById("ptnName"),r=function(){return app.data.getActivePattern().name=q.value,app.renderPtnOptions(!0)},n=function(){return q.value=app.data.getActivePattern().name},q.addEventListener("blur",r,!1),app.refreshPtnOptions=function(a){var c;return a===!0&&b(),c=app.data.getActivePattern(),i(c),j(c),n()},o=function(a){var b,c,d;if(c=a.keyCode,b=document.getElementById("activePtnInput"),33===c?g():34===c?e():36===c?w():35===c?u():45===c?B():46===c&&z(),null!=b){if(d=b.parentNode.className,37===c&&"funct"!==d)return b.parentElement.previousSibling.click();if(39===c&&"DLYdepth"!==d)return b.parentElement.nextSibling.click();if(38===c){if(b=b.parentElement.parentElement.previousSibling,null!=b)return b.getElementsByClassName(d)[0].click()}else if(40===c){if(b=b.parentElement.parentElement.nextSibling,null!=b)return b.getElementsByClassName(d)[0].click()}else if(13===c)return b.click(a,!1)}},document.addEventListener("keyup",o,!1)}.call(this),function(){window.onload=function(){return app.refreshPtnOptions(!0),app.renderPattern(app.data.getActivePattern()),app.renderPtnOptions(!0),app.initAnimation(),app.play()}}.call(this);